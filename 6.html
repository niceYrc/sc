<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title></title>
        <style>
            table{
                width:50%;
                position:relative;
                margin:30px auto;
                border-collapse: collapse;
                border:1px solid gray;
            }
            th{
                background: yellow;
                height:2.5em;
                margin: 0 auto;
            }
            tr{
                height:2.5em;
                margin: 0 auto;
                text-align: center;
            }
        </style>
    </head>
    <body>
        <table border="">
            <tr>
                <th>商品名称</th>
                <th>数量</th>
                <th>单价</th>
                <th>小计</th>
                <th>操作</th>
            </tr>
            <tr>
                <td>烧煎饼</td>
                <td><button>-</button><span class="goods-num">3</span><button>+</button></td>
                <td>单价:<span class="goods-price">2</span></td>
                <td>小计:<span class="goods-single-price">88</span></td>
                <td>操作:<input type="button" class = "del" value="删除"></button></td>
            </tr>
            <tr>
                <td>水煮鱼</td>
                <td>
                    <button>-</button>
                    <span class="goods-num">5</span>
                    <button>+</button>
                </td>
                <td>单价:<span class="goods-price">15</span></td>
                <td>小计:<span class="goods-single-price">55</span></td>
                <td>操作:<input type="button" class = "del" value="删除"></button></td>
            </tr>
            <tr>
                <td colspan="5">一共 <span id = "goods-total-num">0</span> 件商品,共计花费 <span id = "goods-total-price">0</span> 元。</td>
            </tr>
        </table>
    </body>
</html>
<script>
    class Cart{
        constructor() {
        }
        //总共购物车有多少个商品
        getGoodsNumAndUpdate(){
            let oGoodsNum = document.getElementsByClassName("goods-num");
            let goodsTotalNum = 0;
            for(let i=0; i<oGoodsNum.length; i++){
                goodsTotalNum += Number(oGoodsNum[i].innerHTML);
            }
            let oGoodsTotalNum = document.getElementById("goods-total-num");
            oGoodsTotalNum.innerHTML = goodsTotalNum;
        }
        
        //所有商品花了多少钱
        getGoodsPriceAndUpdate(){
            let oGoodPrice = document.getElementsByClassName("goods-single-price");
            let goodsTotalPrice = 0;
            for(let i=0; i<oGoodPrice.length; i++){
                goodsTotalPrice += Number(oGoodPrice[i].innerHTML);
            }
            let oGoodsTotalPrice = document.getElementById("goods-total-price");
            oGoodsTotalPrice.innerHTML = goodsTotalPrice;
        }
        
        //计算每个单独商品的小计
        getGoodsSinglePrice(num,price){
            return num*price;
        }
        
        //增加货物
        goodsPlus(btn){
            //通过this找到数量
            let oGoodsNum = btn.previousElementSibling;
            oGoodsNum.innerHTML =(Number(oGoodsNum.innerHTML))+1;
            let oGoodsPrice = btn.parentNode.nextElementSibling.firstElementChild;
            //小计
            let goodsSinglePrice = this.getGoodsSinglePrice(oGoodsNum.innerHTML,oGoodsPrice.innerHTML);
            let oGoodSinglesPrice = btn.parentNode.nextElementSibling.nextElementSibling.firstElementChild;
            oGoodSinglesPrice.innerHTML = goodsSinglePrice;
            this.getGoodsNumAndUpdate();
            this.getGoodsPriceAndUpdate();
        }
        
        //减少货物
        goodsMin(btn){
            //通过this找到数量
            let oGoodsNum = btn.nextElementSibling;
            
            if(oGoodsNum.innerHTML>0){
                oGoodsNum.innerHTML =(Number(oGoodsNum.innerHTML))-1;
                let oGoodsPrice = btn.parentNode.nextElementSibling.firstElementChild;
                //小计
                let goodsSinglePrice = this.getGoodsSinglePrice(oGoodsNum.innerHTML,oGoodsPrice.innerHTML);
                let oGoodSinglesPrice = btn.parentNode.nextElementSibling.nextElementSibling.firstElementChild;
                oGoodSinglesPrice.innerHTML = goodsSinglePrice;
                this.getGoodsNumAndUpdate();
                this.getGoodsPriceAndUpdate();
            }
        }
        
        //删除货物
        goodsDel(btn){
            let tr = btn.parentNode.parentNode;
            tr.remove();
            this.getGoodsNumAndUpdate();
            this.getGoodsPriceAndUpdate();
        }
        
        //事件绑定
        eventBind(){
            let btn = document.getElementsByTagName("button");
            let that = this;
            let btnDel = document.getElementsByClassName("del");
            for(let i=0; i<btn.length; i++){
                if(i%2==0){
                    btn[i].onclick = function(){
                        that.goodsMin(this);
                    }
                }else{
                    btn[i].onclick = function(){
                        that.goodsPlus(this);
                    }
                }
            }
            for(let i=0; i<btnDel.length; i++){
                btnDel[i].onclick = function(){
                    that.goodsDel(this);
                }
            }
        }
    }
    
    let c = new Cart();
    c.eventBind();
</script>